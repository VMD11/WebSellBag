@model SellingBags.Models.DataContext.VirtualCartContext

@using SellingBags.Common
@{
    ViewBag.Title = "Cart";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="container-fluid">
    <!-- Start All Title Box -->
    <div class="all-title-box">
        <div class="container">
            <div class="row">
                <div class="col-lg-12">
                    <h2>Giỏ hàng</h2>
                    <ul class="breadcrumb">
                        <li class="breadcrumb-item"><a href="@Url.Action("Index","Home")">Trang chủ</a></li>
                        <li class="breadcrumb-item active">Giỏ hàng</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
    <!-- End All Title Box -->
    <!-- Start Cart  -->
    <div class="cart-box-main">
        <div class="container">
            @if (Model.GetList().Count != 0)
            {
                <div class="row">
                    <div class="col-lg-12">
                        <div class="table-main table-responsive">
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>Ảnh</th>
                                        <th>Tên sản phẩm</th>
                                        <th>Màu / Size</th>
                                        <th>Giá</th>
                                        <th>Số lượng</th>
                                        <th>Xóa</th>
                                    </tr>
                                </thead>
                                <tbody>

                                    @{
                                        int TotalQuantity = 0;
                                        foreach (var item in Model.GetList())
                                        {
                                            TotalQuantity += item.Quantity;
                                            <tr>
                                                <td class="thumbnail-img">
                                                    <img class="img-fluid" src="~/Assets/images/products/@item.Product.ImageURL" alt="" />
                                                </td>
                                                <td class="name-pr">
                                                    <a href="@Url.Action("Detail", "Product", new { ID_Product = item.Product.ID_Product.Trim() })">
                                                        @item.Product.Name
                                                    </a>
                                                </td>
                                                <td>
                                                    <p>Màu: @item.Product.Color</p>
                                                    <p>Size: @item.Product.Size</p>
                                                </td>
                                                <td class="price-pr">
                                                    <p>@Converts.convertVND(item.Product.Price)</p>
                                                </td>
                                                <td>
                                                    <div class="quantity-box mt-3">
                                                        <div class="book-number">
                                                            <div class="minus" data-id="@item.Product.ID_Product"><i class="fa-solid fa-minus"></i></div>
                                                            <div class="input-number"><input type="number" name="Quantity" value="@item.Quantity" min="1" class="quantity"></div>
                                                            <div class="plus" data-id="@item.Product.ID_Product" data-quantity="@item.Product.Quantity"><i class="fa-solid fa-plus"></i></div>
                                                        </div>
                                                    </div>
                                                    <div id="error"></div>
                                                </td>
                                                <td class="remove-pr delete">
                                                    <a href="@Url.Action("Delete","Cart",new {ID_Product = item.Product.ID_Product.Trim()})">
                                                        <i class="fa fa-times"></i>
                                                    </a>
                                                </td>
                                            </tr>


                                        }
                                    }

                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <div class="row my-5">
                    <div class="col-lg-6 col-sm-12">
                        <div class="coupon-box mb-5">
                            <div class="input-group input-group-sm">
                                <input class="form-control" placeholder="Nhập mã giảm giá" aria-label="Coupon code" type="text">
                                <div class="input-group-append">
                                    <button class="btn btn-theme" type="button">Áp dụng</button>
                                </div>
                            </div>
                        </div>

                    </div>
                    <div class="col-lg-6 col-sm-12">
                        <div class="order-box">
                            <div class="d-flex">
                                <h4>Giá trị đơn hàng</h4>
                                <div class="ml-auto font-weight-bold" id="GrandTotal">@Converts.convertVND(Model.TotalMoney())</div>
                            </div>
                            <div class="d-flex">
                                <h4>Số lượng</h4>
                                <div class="ml-auto font-weight-bold" id="TotalQuantity">@TotalQuantity</div>
                            </div>
                            <div class="d-flex">
                                <h4>Giảm tiền</h4>
                                <div class="ml-auto font-weight-bold">0</div>
                            </div>
                            <hr>
                            <div class="d-flex gr-total">
                                <h5>Thành tiền</h5>
                                <div class="ml-auto h5" id="TotalMoney">@Converts.convertVND(Model.TotalMoney())</div>
                            </div>
                            <hr>
                        </div>
                    </div>
                    <div class="col-lg-9 col-sm-12"></div>
                    <div class="col-lg-3 col-sm-12 shopping-box d-flex">
                        @Html.ActionLink("Đi đến thanh toán", "Checkout", "Cart", null, new { @class = "ml-auto btn hvr-hover text-white" })
                    </div>
                </div>
            }
            else
            {
                <div class="row mb-5">
                    <div class="col-12 mb-4">
                        <h1>Bạn chưa có sản phẩm nào trong giỏ hàng</h1>
                        <h5>Có nhiều sản phẩm mới đợi bạn thêm sản phẩm vào giỏ hàng</h5>
                    </div>
                    <div class="col-12 mb-5">
                        @Html.ActionLink("Dạo một vòng", "Index", "Home", null, new { @class = "btn hvr-hover text-white", @style = "height: 50px; line-height:36.4px" })
                    </div>
                </div>
            }

        </div>
    </div>
    <!-- End Cart -->
</div>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<script type="text/javascript">
    @*$(document).ready(function () {
        $('.minus').on('click', function () {
            var id = $(this).data('id'); 
            var input = $(this).siblings('.input-number').find('.quantity'); 
            var currentValue = parseInt(input.val());
		    if (currentValue > 1) {
			    input.val(currentValue - 1);
			    updateCart(id,input.val());
		    }
	    });

        $('.plus').on('click', function () {
            var id = $(this).data('id'); 
            var input = $(this).siblings('.input-number').find('.quantity'); 
            var currentValue = parseInt(input.val());
            var 
		    input.val(currentValue + 1);
		    updateCart(id,input.val());
	    });

	    function updateCart(id,quantity) {
		    $.ajax({
			    url: '@Url.Action("Update","Cart")', 
			    type: 'POST',
                data: {
                    ID_Product: id,
                    Quantity: quantity
                }, 
                success: function (response) {
                    if (response.result) {
                        $('#TotalQuantity').text(response.TotalQuantity);
                        $('#TotalMoney').text(convertVND(response.TotalMoney));
                        $('#GrandTotal').text(convertVND(response.TotalMoney));
                        $('#countCart').text(response.TotalQuantity);
                    } else {
                        $('#error').text(response.message);
                    }
			    },
			    error: function () {
				    alert('Có lỗi xảy ra khi cập nhật giỏ hàng.');
			    }
		    });
        }

        function convertVND(amount) {
            return new Intl.NumberFormat('vi-VN', { style: 'currency', currency: 'VND' }).format(amount);
        }
    });*@
</script>
